"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[450],{3932:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>g,frontMatter:()=>c,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"getting-started/usage","title":"Usage","description":"To use JTokkit, first create a new EncodingRegistry:","source":"@site/docs/getting-started/usage.md","sourceDirName":"getting-started","slug":"/getting-started/usage","permalink":"/docs/getting-started/usage","draft":false,"unlisted":false,"editUrl":"https://github.com/knuddelsgmbh/jtokkit/tree/main/docs/docs/getting-started/usage.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Usage","sidebar_position":2},"sidebar":"gettingStarted","previous":{"title":"Introduction","permalink":"/docs/getting-started/"},"next":{"title":"Extending JTokkit","permalink":"/docs/getting-started/extending"}}');var i=t(4848),d=t(8453);const c={title:"Usage",sidebar_position:2},s=void 0,a={},r=[{value:"Getting an encoding from the registry",id:"getting-an-encoding-from-the-registry",level:2},{value:"Encoding and decoding text",id:"encoding-and-decoding-text",level:2},{value:"Counting tokens",id:"counting-tokens",level:2},{value:"Encoding text with truncation",id:"encoding-text-with-truncation",level:2}];function l(e){const n={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["To use JTokkit, first create a new ",(0,i.jsx)(n.code,{children:"EncodingRegistry"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"EncodingRegistry registry = Encodings.newDefaultEncodingRegistry();\n"})}),"\n",(0,i.jsx)(n.p,{children:"Make sure to keep a reference to the registry, as the creation of the registry is expensive. Creating the registry loads the vocabularies from the classpath. The registry itself handles caching of the loaded encodings. It is thread-safe and can safely be used concurrently by multiple components."}),"\n",(0,i.jsx)(n.p,{children:"If you do not want to automatically load all vocabularies of all encodings on registry creation, you can use the following lazy loading registry."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"EncodingRegistry registry = Encodings.newLazyEncodingRegistry();\n"})}),"\n",(0,i.jsx)(n.p,{children:"This encoding registry only loads the vocabularies from encodings that are actually accessed. Vocabularies are only\nloaded once on first accessed. As with the default encoding registry, make sure to keep a reference to the registry\nto make use of the in-built caching of the vocabularies. It is thread-safe and can safely be used concurrently by\nmultiple components."}),"\n",(0,i.jsx)(n.h2,{id:"getting-an-encoding-from-the-registry",children:"Getting an encoding from the registry"}),"\n",(0,i.jsx)(n.p,{children:"You can use the registry to get the encodings you need:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// Get encoding via type-safe enum\nEncoding encoding = registry.getEncoding(EncodingType.CL100K_BASE);\n\n// Get encoding via string name\nOptional<Encoding> encoding = registry.getEncoding("cl100k_base");\n\n// Get encoding for a specific model via type-safe enum\nEncoding encoding = registry.getEncodingForModel(ModelType.GPT_4);\n\n// Get encoding for a specific model via string name\nOptional<Encoding> encoding = registry.getEncodingForModel("gpt_4");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"encoding-and-decoding-text",children:"Encoding and decoding text"}),"\n",(0,i.jsxs)(n.p,{children:["You can use an ",(0,i.jsx)(n.code,{children:"Encoding"})," to encode and decode text:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'IntArrayList encoded = encoding.encode("This is a sample sentence.");\n// encoded = [2028, 374, 264, 6205, 11914, 13]\n\nString decoded = encoding.decode(encoded);\n// decoded = "This is a sample sentence."\n'})}),"\n",(0,i.jsx)(n.p,{children:"The encoding is also fully thread-safe and can be used concurrently by multiple components."}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["Note that the library does not support encoding of special tokens. Special tokens are artificial tokens used to unlock capabilities from a model, such as fill-in-the-middle. If the ",(0,i.jsx)(n.code,{children:"Encoding#encode"})," method encounters a special token in the input text, it will throw an ",(0,i.jsx)(n.code,{children:"UnsupportedOperationException"}),"."]}),(0,i.jsxs)(n.p,{children:["If you want to encode special tokens as if they were normal text, you can use ",(0,i.jsx)(n.code,{children:"Encoding#encodeOrdinary"})," instead:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'encoding.encode("hello <|endoftext|> world");\n// raises an UnsupportedOperationException\n\nencoding.encodeOrdinary("hello <|endoftext|> world");\n// returns [15339, 83739, 8862, 728, 428, 91, 29, 1917]\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"counting-tokens",children:"Counting tokens"}),"\n",(0,i.jsxs)(n.p,{children:["If all you want is the amount of tokens the text encodes to, you can use the shorthand method ",(0,i.jsx)(n.code,{children:"Encoding#countTokens"})," or ",(0,i.jsx)(n.code,{children:"Encoding#countTokensOrdinary"}),". These methods are faster than the corresponding ",(0,i.jsx)(n.code,{children:"encode"})," methods."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'int tokenCount = encoding.countTokens("This is a sample sentence.");\n// tokenCount = 6\n\nint tokenCount = encoding.countTokensOrdinary("hello <|endoftext|> world");\n// tokenCount = 8\n'})}),"\n",(0,i.jsx)(n.h2,{id:"encoding-text-with-truncation",children:"Encoding text with truncation"}),"\n",(0,i.jsxs)(n.p,{children:["If you want to only encode up until a specified amount of ",(0,i.jsx)(n.code,{children:"maxTokens"})," and truncate after that amount, you can use ",(0,i.jsx)(n.code,{children:"Encoding#encode(String, int)"})," or ",(0,i.jsx)(n.code,{children:"Encoding#encodeOrdinary(String, int)"}),". These methods will truncate the encoded tokens to the specified length. They will automatically handle unicode characters that were split in half by the truncation by removing those tokens from the end of the list."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'IntArrayList encoded = encoding.encode("This is a sample sentence.", 3);\n// encoded = [2028, 374, 264]\n\nString decoded = encoding.decode(encoded);\n// decoded = "This is a"\n\nIntArrayList encoded = encoding.encode("I love \ud83c\udf55", 4);\n// encoded = [40, 3021]\n\nString decoded = encoding.decode(encoded);\n// decoded = "I love"\n'})})]})}function g(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>s});var o=t(6540);const i={},d=o.createContext(i);function c(e){const n=o.useContext(d);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),o.createElement(d.Provider,{value:n},e.children)}}}]);